# propertybot-data-engineering

## Table of Contents

---

- [Data Pipeline](#Data-Pipeline)
  - [Data Collection & Enrichment](#Data-Collection-&-Enrichment)
- [Data Sources](#Data-Sources)
  - [Listings](#Properties-for-Sale)
  - [Details](#Property-Details)

## Data Pipeline

---

### Data Collection & Enrichment

Automated process to start the Reckognition models and stay up to date with given areas.

- 1 - Eventbridge starts model Lambdas:
  - start_all_models
- 2 - start_all_models sends independent messages to start all models on the rekognition-models SQS queue
- 3 - start_stop_models reads the messages starts the model
- 4 - 30 minutes later Eventbridge starts data collection by triggering - Lambda: get_properties_for_area
- 3 - get_properties_for_area loads each specific property onto the the
  new-listings SQS queue as a seperate message. Note: loads in chunks of 200 until a property that is already in dynamo is fetched
- 4 - get_property_details reads these messages, ensures that each message is not processed yet by crossrefrenceing dynamo, hits the description NLP, image processing through the room specific Reckognition custom label projects, saves to dynamo, writes a message to the cleaned_properties queue
- 5 - Node Server picks up the cleaned_properties, adds remodel data, persists in RDS

#### Remove Sold Listings - Lambda

Automated archival of sold properties.

- 1 - Eventbridge starts model Lambdas:
  - get_sold_properties_for_area
- 2 - get_sold_properties_for_area marks all properties as sold in dynamo and sends independent messages to mark a property as sold on the sold-properties SQS queue
- 3 - mark_property_sold reads the messages marks the property sold in RDS

### Deployment

All deployments are taken care of with every push by an automated CI/CD pipeline, leveraging github [actions](https://github.com/propertybot/data-pipeline/blob/main/.github/workflows/main.yml) and [serverless](serverless.yml).

## Data Sources

---

## Listings

**Source: [Realty in US through RapidAPI.com](https://rapidapi.com/apidojo/api/realty-in-us/)**

### Example API Call

```python
import requests

url = "https://realty-in-us.p.rapidapi.com/properties/v2/list-for-sale"

querystring = {"city":"New York City","state_code":"NY","offset":"0","limit":"200","sort":"relevance"}

headers = {
    'x-rapidapi-host': "realty-in-us.p.rapidapi.com",
    'x-rapidapi-key': YOUR_KEY_HERE
    }

response = requests.request("GET", url, headers=headers, params=querystring)

print(response.text)

```

### Parameters - Required

| parameter    | format | example         | description                                                                                                        |
| :----------- | :----- | :-------------- | :----------------------------------------------------------------------------------------------------------------- |
| `city`       | string | "New York City" | The value of city field responded in locations/auto-complete API (do not use this parameter with postal_code       |
| `state_code` | string | "NY"            | The value of state_code field responded in locations/auto-complete API (do not use this parameter with postal_code |
| `offset`     | number | 0               | The offset of items to be ignored in response for paging                                                           |
| `limit`      | number | 200             | The number of items to be responded in every request                                                               |

### Parameters - Optional

| parameter             | format  | example           | description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| :-------------------- | :------ | :---------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `postal_code`         | STRING  | "90094"           | Zip code or postal code (do not use this parameter with city and state_code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `sort`                | STRING  | "newest"          | One of the followings, separated by comma for multiple values: relevance, newest, price_low, price_high, photos, open_house_date, sqft_high, price_reduced_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `prop_type`           | STRING  | "single_family"   | One of the followings (separated by comma for multiple values): single_family, multi_family, condo, mobile, land, farm, other                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `prop_sub_type`       | STRING  | "condo"           | One of the followings (separated by comma for multiple values): condo, cond_op, townhouse, co_op                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `features`            | STRING  | "hardwood_floors" | One of the followings (separated by comma for multiple values): garage_2_or_more, view, waterfront, golf_course_view, swimming_pool, cul_de_sac, hardwood_floors, basement, fireplace, energy_efficient, disability_features, dining_room, washer_dryer, family_room, den_or_office, game_room,central_air, central_heat, forced_air, single_story, two_or_more_stories, corner_lot,water_view, golf_course_lot_or_frontage, hill_or_mountain_view, ocean_view, city_view, lake_view, river_view, community_security_features, community_swimming_pool, community_boat_facilities, recreation_facilities, community_clubhouse, community_horse_facilities, community_tennis_court, community_park, community_golf, senior_community, community_spa_or_hot_tub, rv_or_boat_parking, horse_facilities, tennis_court, spa_or_hot_tub, garage_1_or_more, garage_3_or_more,carport |
| `radius`              | NUMBER  | 2                 | Radius in miles to look for properties (1 to 20)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `age_min`             | NUMBER  | 10                | Min age of properties                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `age_max`             | NUMBER  | 50                | Max age of properties                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `sqft_min`            | NUMBER  | 800               | Min size of the properties                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `sqft_max`            | NUMBER  | 2500              | Max size of the properties                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `beds_min`            | NUMBER  | 1                 | Min baths of properties                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `beds_max`            | NUMBER  | 4                 | Max baths of properties                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `price_min`           | NUMBER  | 100000            | Option filter by setting min price                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `price_max`           | NUMBER  | 250000            | Option filter by setting max price                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `lot_sqft_min`        | NUMBER  | 1                 | Min Lot/Acreage size                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `lot_sqft_max`        | NUMBER  | 3                 | Max Lot/Acreage size                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `is_matterports`      | BOOLEAN | false             | true/false - 3D tours only                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `is_foreclosure`      | BOOLEAN | false             | true/false - Foreclosures only                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `has_open_house`      | BOOLEAN | false             | true/false - Open houses only                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `is_new_construction` | BOOLEAN | false             | true/false - New construction only                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `is_contingent`       | BOOLEAN | false             | true/false - Contingent only                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `is_pending`          | BOOLEAN | false             | true/false - Pending only                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `is_new_plan`         | BOOLEAN | false             | true/false - Homes not yet built                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `lat_max`             | NUMBER  | 36.778259         | Look for properties in bounding box, this is the max latitude of the coordinate. Has no affect if postal_code, or city or state_code parameter has value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `lat_min`             | NUMBER  | 36.778259         | Look for properties in bounding box, this is the min latitude of the coordinate. Has no affect if postal_code, or city or state_code parameter has value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `lng_max`             | NUMBER  | 36.778259         | Look for properties in bounding box, this is the max longitude of the coordinate. Has no affect if postal_code, or city or state_code parameter has value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `lng_min`             | NUMBER  | 36.778259         | Look for properties in bounding box, this is the min longitude of the coordinate. Has no affect if postal_code, or city or state_code parameter has value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

## Details

**Source: [Realty in US through RapidAPI.com](https://rapidapi.com/apidojo/api/realty-in-us/)**

### Example API Call

```Python
import requests

url = "https://realty-in-us.p.rapidapi.com/properties/v2/detail"

querystring = {"property_id":"O3599084026"}

headers = {
    'x-rapidapi-host': "realty-in-us.p.rapidapi.com",
    'x-rapidapi-key': YOUR_KEY_HERE
    }

response = requests.request("GET", url, headers=headers, params=querystring)

print(response.text)

```

### Parameters - Required

| parameter     | format | example       | description                                                                                          |
| :------------ | :----- | :------------ | :--------------------------------------------------------------------------------------------------- |
| `property_id` | string | "O3599084026" | The value of property_id field returned in …/properties/list-…. or …/properties/v2/list-… endpoints. |

### Parameters - Optional

**None**
